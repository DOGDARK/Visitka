<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link rel="stylesheet" href="styles.css" />
<title>Mini App</title>
</head>
<body>

<!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
<div class="nav">
    <div class="nav-item" onclick="openPage('screen1')">üè†</div>
    <div class="nav-item" onclick="openPage('screen2')">üìù</div>
</div>

<!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
<div id="screen1" class="page active">
    <div style="text-align:center; margin-top:40px;">
        <h1 id="companyName">–ù–∞–∑–≤–∞–Ω–∏–µ</h1>
        <p id="companyDesc">–û–ø–∏—Å–∞–Ω–∏–µ</p>
    </div>

    <div class="news-block">
        <h2>–ù–æ–≤–æ—Å—Ç–∏</h2>
        <div class="news-card">
            <h3>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏ 1</h3>
            <p>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</p>
        </div>
        <div class="news-card">
            <h3>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏ 2</h3>
            <p>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</p>
        </div>
    </div>
</div>

<!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞ -->
<div id="screen2" class="page">
    <h1>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</h1>
    <div class="form">
        <input id="name" type="text" placeholder="–í–∞—à–µ –∏–º—è" />
        <input id="username" type="text" placeholder="–í–∞—à Telegram @username" />
        <textarea id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞"></textarea>
        <div class="btn" onclick="sendOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</div>
    </div>
</div>

<script>
/* –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü */
function openPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
}

/* –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ */
function showMessage(msg, duration = 3000) {
    const div = document.createElement("div");
    div.className = "message";
    div.textContent = msg;
    document.body.appendChild(div);
    setTimeout(() => div.remove(), duration);
}

/* –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã */
function sendOrder() {
    // const initData = Telegram.WebApp.initData;
    const initData = "user={\"id\":1212333}&auth_date=1234567890";
    // const user = Telegram.WebApp.initDataUnsafe.user || {};

    const name = document.getElementById("name").value.trim();
    const username = document.getElementById("username").value.trim();
    const description = document.getElementById("description").value.trim();

    if (!name || !description) {
        showMessage("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è");
        return;
    }

    const payload = {
        init_data: initData,
        first_name: name || null,
        last_name: username || null
        // form_name: name,
        // form_username: username,
        // form_description: description
    };

    fetch("http://0.0.0.0:8000/users", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    })
    .then(response => {
        if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏");
        return response.json();
    })
    .then(data => {
        showMessage("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
        document.getElementById("name").value = "";
        document.getElementById("username").value = "";
        document.getElementById("description").value = "";
    })
    .catch(error => {
        console.error(error);
        showMessage("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ!");
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.getElementById('screen1').classList.add('active');
</script>

</body>
</html>
